<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ND Calc Pro</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-main: #18181b;
            --text-muted: #a1a1aa;
            --accent: #3b82f6;
            --picker-mask: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 20%, rgba(255,255,255,1) 80%, rgba(255,255,255,0) 100%);
        }

        .dark {
            --bg-color: #09090b;
            --text-main: #f4f4f5;
            --text-muted: #52525b;
            --accent: #60a5fa;
            --picker-mask: linear-gradient(to right, rgba(9,9,11,0) 0%, rgba(9,9,11,1) 20%, rgba(9,9,11,1) 80%, rgba(9,9,11,0) 100%);
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            transition: background-color 0.3s ease;
            overflow-x: hidden;
            padding-bottom: 180px;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .picker-container {
            -webkit-mask-image: var(--picker-mask);
            mask-image: var(--picker-mask);
            touch-action: pan-x;
            position: relative;
            display: flex;
            align-items: center;
        }

        .picker-scroll {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            width: 100%;
            height: 100%;
            align-items: center;
        }

        .picker-item {
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            opacity: 0.2;
            transform: scale(0.8);
            color: var(--text-muted);
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            scroll-snap-align: center;
        }
        
        .picker-item.active {
            transform: scale(1.25);
            font-weight: 800;
            color: var(--text-main);
            opacity: 1;
        }

        #cplToggle:checked ~ .toggle-bg { background-color: var(--accent); }
        #cplToggle:checked ~ .toggle-dot { transform: translateX(100%); }

        .floating-result {
            position: fixed;
            bottom: 24px;
            left: 5%;
            right: 5%;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 20px 50px -12px rgba(0,0,0,0.15);
            z-index: 50;
            border: 1px solid rgba(0,0,0,0.04);
        }
        .dark .floating-result {
            background: #1c1c1e;
            border-color: rgba(255,255,255,0.08);
            box-shadow: 0 20px 50px -12px rgba(0,0,0,0.5);
        }

        @media (min-width: 1024px) {
            body { padding-bottom: 0; }
            .floating-result {
                position: relative;
                bottom: 0;
                left: 0;
                right: 0;
                margin-top: 40px;
            }
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-6xl mx-auto flex flex-col lg:flex-row gap-8 pt-6 px-4 lg:px-8">
        
        <div class="w-full lg:w-1/2 lg:max-w-md mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-black tracking-tight uppercase">ND-Calc Pro</h1>
                <button id="themeToggle" class="p-2.5 bg-zinc-100 dark:bg-zinc-800 rounded-full">
                    <svg id="sunIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m0-11.314l.707.707m11.314 11.314l.707.707M12 8a4 4 0 110 8 4 4 0 010-8z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    <svg id="moonIcon" class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                </button>
            </div>

            <div class="space-y-6">
                <div class="flex items-center justify-between px-2">
                    <div>
                        <span class="text-base font-bold">CPL Filter</span>
                        <p class="text-[10px] text-zinc-400">1.3 Stop 추가 차단</p>
                    </div>
                    <label for="cplToggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="cplToggle" class="sr-only">
                        <div class="toggle-bg w-14 h-8 bg-zinc-200 dark:bg-zinc-800 rounded-full transition-colors duration-300"></div>
                        <div class="toggle-dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 shadow-sm"></div>
                    </label>
                </div>

                <div class="space-y-4">
                    <!-- Filter 1 -->
                    <div class="bg-zinc-50 dark:bg-zinc-900/50 rounded-3xl py-4 border border-transparent dark:border-zinc-800">
                        <div class="px-6 mb-2 flex justify-between items-center">
                            <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Filter 01</span>
                            <span id="nd1Value" class="text-xs font-bold text-blue-500 bg-blue-50 dark:bg-blue-900/20 px-2 py-0.5 rounded-full">ND1000</span>
                        </div>
                        <div class="picker-container h-16">
                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-9 border-y border-zinc-200 dark:border-zinc-700 pointer-events-none z-10"></div>
                            <div id="nd1Picker" class="picker-scroll no-scrollbar"></div>
                        </div>
                    </div>

                    <!-- Filter 2 -->
                    <div class="bg-zinc-50 dark:bg-zinc-900/50 rounded-3xl py-4 border border-transparent dark:border-zinc-800">
                        <div class="px-6 mb-2 flex justify-between items-center">
                            <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Filter 02</span>
                            <span id="nd2Value" class="text-xs font-bold text-blue-500 bg-blue-50 dark:bg-blue-900/20 px-2 py-0.5 rounded-full">OFF</span>
                        </div>
                        <div class="picker-container h-16">
                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-9 border-y border-zinc-200 dark:border-zinc-700 pointer-events-none z-10"></div>
                            <div id="nd2Picker" class="picker-scroll no-scrollbar"></div>
                        </div>
                    </div>

                    <!-- Base Shutter -->
                    <div class="bg-zinc-50 dark:bg-zinc-900/50 rounded-3xl py-4 border border-transparent dark:border-zinc-800">
                        <div class="px-6 mb-2 flex justify-between items-center">
                            <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Base Shutter</span>
                            <span id="baseValue" class="text-xs font-bold text-blue-500 bg-blue-50 dark:bg-blue-900/20 px-2 py-0.5 rounded-full">1/60</span>
                        </div>
                        <div class="picker-container h-16">
                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-9 border-y border-zinc-200 dark:border-zinc-700 pointer-events-none z-10"></div>
                            <div id="shutterPicker" class="picker-scroll no-scrollbar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="floating-result p-7 flex items-center justify-between">
                <button id="resetBtn" class="w-14 h-14 rounded-2xl bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center active:scale-90 transition-all">
                    <svg class="w-6 h-6 text-zinc-500 dark:text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                </button>
                <div class="text-right">
                    <p class="text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-1">Final Shutter</p>
                    <div id="finalShutter" class="text-4xl font-black tabular-nums tracking-tighter leading-none dark:text-white">--</div>
                    <p id="totalStops" class="text-[10px] font-bold text-blue-500 dark:text-blue-400 mt-2 uppercase">총 0 Stop 감소</p>
                </div>
            </div>
        </div>

        <div class="hidden lg:block w-1/2">
            <div class="bg-white dark:bg-zinc-900 p-10 rounded-[40px] border border-zinc-100 dark:border-zinc-800 h-full">
                <h2 class="text-2xl font-black mb-8 dark:text-white uppercase">Shooting Tips</h2>
                <div class="space-y-12">
                    <section>
                        <h3 class="font-bold text-blue-500 dark:text-blue-400 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-blue-500"></span> 바다의 몽환적인 연출
                        </h3>
                        <p class="text-sm text-zinc-500 dark:text-zinc-400 mt-3 leading-relaxed">
                            30초 이상의 장노출은 거친 파도를 안개처럼 바꿔줍니다. ND1000 필터가 가장 많이 쓰이며, 일출/일몰 직후 촬영이 가장 좋습니다.
                        </p>
                    </section>
                    <section>
                        <h3 class="font-bold text-blue-500 dark:text-blue-400 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-blue-500"></span> 계곡 물줄기 궤적
                        </h3>
                        <p class="text-sm text-zinc-500 dark:text-zinc-400 mt-3 leading-relaxed">
                            1/4초에서 1초 사이가 물의 생동감을 표현하기 좋습니다. ND8~ND64 범위를 활용해 보세요.
                        </p>
                    </section>
                    <div class="p-7 bg-zinc-50 dark:bg-zinc-800/40 rounded-3xl border border-zinc-100 dark:border-zinc-800">
                        <h4 class="text-xs font-black uppercase tracking-widest mb-4 text-zinc-400">Checklist</h4>
                        <ul class="text-xs text-zinc-500 dark:text-zinc-400 space-y-4">
                            <li>• 손떨림 방지 기능(OSS/IS) OFF</li>
                            <li>• 셔터 릴리즈 또는 2초 타이머 사용</li>
                            <li>• 뷰파인더 가림 (DSLR 기종 필수)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ndFilters = [
            { label: 'OFF', stops: 0 }, { label: 'ND2', stops: 1 }, { label: 'ND4', stops: 2 },
            { label: 'ND8', stops: 3 }, { label: 'ND16', stops: 4 }, { label: 'ND32', stops: 5 },
            { label: 'ND64', stops: 6 }, { label: 'ND128', stops: 7 }, { label: 'ND256', stops: 8 },
            { label: 'ND500', stops: 9 }, { label: 'ND1000', stops: 10 }
        ];

        const shutterSpeeds = [
            { label: '1/4000', value: 1/4000 }, { label: '1/2000', value: 1/2000 },
            { label: '1/1000', value: 1/1000 }, { label: '1/500', value: 1/500 },
            { label: '1/250', value: 1/250 }, { label: '1/125', value: 1/125 },
            { label: '1/60', value: 1/60 }, { label: '1/30', value: 1/30 },
            { label: '1/15', value: 1/15 }, { label: '1/8', value: 1/8 },
            { label: '1/4', value: 1/4 }, { label: '1/2', value: 1/2 },
            { label: '1"', value: 1 }, { label: '2"', value: 2 },
            { label: '4"', value: 4 }, { label: '8"', value: 8 },
            { label: '15"', value: 15 }, { label: '30"', value: 30 }
        ];

        let state = { currentND1: 10, currentND2: 0, currentShutter: 6 };
        const itemWidth = 85; // 개별 아이템의 고정 너비

        function initPicker(id, data, defaultIdx, displayId, stateKey) {
            const container = document.getElementById(id);
            const display = document.getElementById(displayId);
            
            // 아이템 생성
            container.innerHTML = '';
            const items = data.map((d, i) => {
                const el = document.createElement('div');
                el.className = `picker-item`;
                el.style.width = `${itemWidth}px`;
                el.innerText = d.label;
                el.onclick = () => scrollToIdx(i);
                container.appendChild(el);
                return el;
            });

            const updatePaddings = () => {
                const viewWidth = container.offsetWidth;
                const sidePadding = (viewWidth / 2) - (itemWidth / 2);
                container.style.paddingLeft = `${sidePadding}px`;
                container.style.paddingRight = `${sidePadding}px`;
            };

            const scrollToIdx = (idx, behavior = 'smooth') => {
                container.scrollTo({ left: idx * itemWidth, behavior });
            };

            let scrollTimer;
            container.onscroll = () => {
                const scrollLeft = container.scrollLeft;
                const idx = Math.min(data.length - 1, Math.max(0, Math.round(scrollLeft / itemWidth)));
                
                items.forEach((el, i) => {
                    if (i === idx) el.classList.add('active');
                    else el.classList.remove('active');
                });

                if (state[stateKey] !== idx) {
                    state[stateKey] = idx;
                    display.innerText = data[idx].label;
                    clearTimeout(scrollTimer);
                    scrollTimer = setTimeout(calculate, 20);
                }
            };

            // ResizeObserver를 사용하여 컨테이너 크기 변화 감지 (모바일 초기 로드 대응)
            new ResizeObserver(() => {
                updatePaddings();
                scrollToIdx(state[stateKey], 'auto');
            }).observe(container);

            return { scroll: scrollToIdx, refresh: () => { updatePaddings(); scrollToIdx(state[stateKey], 'auto'); } };
        }

        function calculate() {
            const base = shutterSpeeds[state.currentShutter].value;
            const stops = ndFilters[state.currentND1].stops + ndFilters[state.currentND2].stops + (document.getElementById('cplToggle').checked ? 1.3 : 0);
            const res = base * Math.pow(2, stops);

            document.getElementById('totalStops').innerText = `총 ${stops.toFixed(1)} Stop 감소`;
            
            const display = document.getElementById('finalShutter');
            // 다크모드 대응을 위해 인라인 스타일 대신 클래스 조합 고려 가능하나, 여기선 색상 확실히 지정
            if (res >= 3600) {
                display.innerHTML = `${Math.floor(res/3600)}<span class="text-lg opacity-60 ml-0.5">h</span> ${Math.floor((res%3600)/60)}<span class="text-lg opacity-60 ml-0.5">m</span>`;
            } else if (res >= 60) {
                display.innerHTML = `${Math.floor(res/60)}<span class="text-lg opacity-60 ml-0.5">m</span> ${Math.round(res%60)}<span class="text-lg opacity-60 ml-0.5">s</span>`;
            } else if (res >= 1) {
                display.innerHTML = `${res < 10 ? res.toFixed(1) : Math.round(res)}<span class="text-lg opacity-60 ml-0.5">s</span>`;
            } else {
                display.innerHTML = `<span class="text-2xl opacity-30">1/</span>${Math.round(1/res)}<span class="text-lg opacity-60 ml-0.5">s</span>`;
            }
        }

        let pickers = {};
        window.addEventListener('load', () => {
            pickers.p1 = initPicker('nd1Picker', ndFilters, 10, 'nd1Value', 'currentND1');
            pickers.p2 = initPicker('nd2Picker', ndFilters, 0, 'nd2Value', 'currentND2');
            pickers.p3 = initPicker('shutterPicker', shutterSpeeds, 6, 'baseValue', 'currentShutter');
            
            // 모바일 브라우저의 레이아웃 확정을 위한 마지막 지연 트리거
            setTimeout(() => {
                Object.values(pickers).forEach(p => p.refresh());
                calculate();
            }, 300);
        });

        document.getElementById('cplToggle').onchange = calculate;
        document.getElementById('themeToggle').onclick = () => document.documentElement.classList.toggle('dark');
        document.getElementById('resetBtn').onclick = () => {
            document.getElementById('cplToggle').checked = false;
            pickers.p1.scroll(10); pickers.p2.scroll(0); pickers.p3.scroll(6);
            calculate();
        };
    </script>
</body>
</html>
